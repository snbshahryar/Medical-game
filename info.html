<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ثبت اطلاعات شخصی</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Vazirmatn', sans-serif; direction: rtl; background: #f0f7ff; text-align: center; padding: 20px; }
  h1 { color: #0d6efd; }
  form { display: inline-block; text-align: right; margin-top: 20px; }
  label { display: block; margin: 10px 0 5px; font-weight: 600; }
  input, select { width: 250px; padding: 8px; border-radius: 6px; border: 1px solid #bbb; margin-bottom: 10px; font-family: 'Vazirmatn', sans-serif; }
  #otherJob { display: none; }
  button { font-size: 18px; padding: 10px 20px; border: none; border-radius: 8px; background: #0d6efd; color: white; font-weight: 600; cursor: pointer; margin-top: 10px; font-family: 'Vazirmatn', sans-serif; }
  .codeBox { margin-top: 20px; font-size: 22px; font-weight: bold; color: #0d6efd; font-family: 'Vazirmatn', sans-serif; }
</style>
</head>
<body>

<h1>📝 ثبت اطلاعات شخصی</h1>
<form id="infoForm">
  <label>نام و نام خانوادگی:</label>
  <input type="text" id="fullName" required>
  <label>شماره تماس:</label>
  <input type="text" id="phone" required>
  <label>شماره نظام:</label>
  <input type="text" id="idNumber" required>
  <label>شغل:</label>
  <select id="job" required>
    <option value="">انتخاب کنید</option>
    <option value="doctor">پزشک</option>
    <option value="nurse">پرستار</option>
    <option value="other">سایر</option>
  </select>
  <input type="text" id="otherJob" placeholder="لطفا شغل خود را وارد کنید">
  <button type="submit">ثبت و دریافت کد یونیک</button>
</form>

<div class="codeBox" id="finalCodeBox"></div>

<script>
const jobSelect = document.getElementById("job");
const otherJobInput = document.getElementById("otherJob");
jobSelect.addEventListener("change", () => {
  otherJobInput.style.display = (jobSelect.value === "other") ? "block" : "none";
});

const form = document.getElementById("infoForm");
const codeBox = document.getElementById("finalCodeBox");

// لینک Web App گوگل شیت
const SHEET_URL = "https://script.google.com/macros/s/AKfycbwPEsKcfNCqokFU_jpCR4oKdLdbwhcBAPknLiwMqUOreafENmvJSmnbWAfyn06eLAhN/exec";

form.addEventListener("submit", (e) => {
  e.preventDefault();
  
  const fullName = document.getElementById("fullName").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const idNumber = document.getElementById("idNumber").value.trim();
  let job = jobSelect.value;
  if (job === "other") { job = otherJobInput.value.trim() || "other"; }

  // تعیین پیشوند براساس شغل
  let prefix = "S";
  if (jobSelect.value === "doctor") prefix = "D";
  else if (jobSelect.value === "nurse") prefix = "N";

  const tempCode = localStorage.getItem("tempCode") || Math.random().toString(36).substring(2, 8).toUpperCase();
  const finalCode = prefix + "-" + tempCode;  // اضافه کردن پیشوند

  codeBox.textContent = "🎉 کد یونیک شما: " + finalCode;

  // ارسال داده‌ها به گوگل شیت
  fetch(SHEET_URL, {
    method: "POST",
    body: new URLSearchParams({
      fullName: fullName,
      phone: phone,
      idNumber: idNumber,
      job: job,
      finalCode: finalCode
    })
  })
  .then(response => response.json())
  .then(data => {
    if(data.status === "success"){
      console.log("اطلاعات با موفقیت ثبت شد.");
    } else {
      console.error("خطا در ثبت اطلاعات:", data.message);
      alert("⚠️ خطایی در ثبت اطلاعات رخ داد. دوباره تلاش کنید.");
    }
  })
  .catch(err => {
    console.error("خطای شبکه:", err);
    alert("⚠️ ارتباط با سرور برقرار نشد.");
  });
});
</script>

</body>
</html>
