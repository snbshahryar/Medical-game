<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Vazirmatn', sans-serif;
  direction: rtl;
  background: url("IMG_0144 copy.jpg") no-repeat center center fixed;
  background-size: cover;
  text-align: center;
  padding: 20px;
  margin: 0;
  position: relative;
  min-height: 100vh;
}
.overlay {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(255, 255, 255, 0.5);
  z-index: 0;
}
h1 {
  color: #0d6efd;
  position: relative;
  z-index: 1;
}
form {
  position: relative;
  z-index: 1;
  display: inline-block;
  text-align: right;
  margin-top: 20px;
  background: rgba(255, 255, 255, 0.85);
  padding: 25px 40px;
  border-radius: 20px;
  box-shadow: 0 0 15px rgba(0,0,0,0.1);
}
label { display: block; margin: 10px 0 5px; font-weight: 600; }
input, select {
  width: 250px;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #bbb;
  margin-bottom: 10px;
  font-family: 'Vazirmatn', sans-serif;
}
button {
  font-size: 18px;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  background: #0d6efd;
  color: white;
  font-weight: 600;
  cursor: pointer;
  margin-top: 10px;
  font-family: 'Vazirmatn', sans-serif;
  transition: 0.3s;
}
button:hover {
  background: #084ed1;
  transform: scale(1.05);
}
.popup {
  display: none;
  position: fixed;
  z-index: 1000;
  right: 0; left: 0; top: 0; bottom: 0;
  background-color: rgba(0, 0, 0, 0.4);
}
.popup-content {
  background: rgba(255,255,255,0.95);
  margin: 12% auto;
  padding: 25px 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  text-align: center;
  animation: fadeIn 0.4s ease;
}
@keyframes fadeIn {
  from { transform: translateY(-10px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
.popup h2 { color: #0d6efd; margin-bottom: 10px; }
.popup p { color: #000; line-height: 1.6; font-size: 15px; }
.popup a { color: #0d6efd; text-decoration: none; }
#codeContainer {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
#popupCode {
  font-weight: bold;
  font-size: 20px;
  color: #0d6efd;
  margin: 0;
}
#copyIcon {
  width: 28px;
  height: 28px;
  cursor: pointer;
  fill: #0d6efd;
  transition: transform 0.2s;
}
#copyIcon:hover { transform: scale(1.2); }
@media (max-width: 600px) {
  .popup-content { width: 85%; padding: 18px 20px; border-radius: 10px; font-size: 14px; margin: 40% auto; }
  .popup h2 { font-size: 18px; }
  .popup p { font-size: 13px; line-height: 1.5; }
  #popupCode { font-size: 18px !important; }
  input, select { width: 200px; }
  form { padding: 20px; }
}
</style>
</head>
<body>

<div class="overlay"></div>

<h1>ğŸ“ Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</h1>

<form id="infoForm">
  <label>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</label>
  <input type="text" id="fullName" required>

  <label>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</label>
  <input type="tel" id="phone" required pattern="^09\d{9}$"
         title="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ ØµÙˆØ±Øª 09xxxxxxxxx ÙˆØ§Ø±Ø¯ Ø´ÙˆØ¯"
         placeholder="Ù…Ø«Ø§Ù„: 09121234567">

  <label>Ø´Ù…Ø§Ø±Ù‡ Ù†Ø¸Ø§Ù…:</label>
  <input type="text" id="idNumber" required placeholder="ÙÙ‚Ø· Ø§Ø¹Ø¯Ø§Ø¯">

  <label>ØªØ®ØµØµ:</label>
  <select id="specialty" required>
    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
    <option value="Ù‚Ù„Ø¨">Ù‚Ù„Ø¨</option>
    <option value="ØºØ¯Ø¯">ØºØ¯Ø¯</option>
    <option value="Ø¯Ø§Ø®Ù„ÛŒ">Ø¯Ø§Ø®Ù„ÛŒ</option>
    <option value="Ø¯ÛŒØ§Ø¨ØªÙˆÙ„ÙˆÚ˜ÛŒ">Ø¯ÛŒØ§Ø¨ØªÙˆÙ„ÙˆÚ˜ÛŒ</option>
  </select>

  <button type="submit">Ø«Ø¨Øª Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯ ÛŒÙˆÙ†ÛŒÚ©</button>
</form>

<div id="popup" class="popup">
  <div class="popup-content">
    <h2>ğŸ‰ Ú©Ø¯ ÛŒÙˆÙ†ÛŒÚ© Ø´Ù…Ø§</h2>
    <div id="codeContainer">
      <p id="popupCode"></p>
      <svg id="copyIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
      </svg>
    </div>
    <p>Ø¬Ù‡Øª Ù†Ù‡Ø§ÛŒÛŒ Ø´Ø¯Ù† Ù…Ø±Ø§Ø­Ù„ Ù‚Ø±Ø¹Ù‡ Ú©Ø´ÛŒ Ù„Ø§Ø²Ù… Ø§Ø³Øª Ú©Ø¯ ÛŒÙˆÙ†ÛŒÚ© Ø®ÙˆØ¯ Ø±Ø§ Ù¾Ø³ Ø§Ø² Ú©Ù¾ÛŒ Ù†Ù…ÙˆØ¯Ù† Ø²ÛŒØ± Ù¾Ø³Øª Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…ÛŒ Ø²ÛŒØ± Ú©Ø§Ù…Ù†Øª Ú©Ù†ÛŒØ¯<br>
      <a href="https://www.instagram.com/p/DQMBYroDajZ/?igsh=MW9yOXFxNjZ5bDc5eA==" target="_blank">Ù„ÛŒÙ†Ú© Ù¾Ø³Øª</a>
    </p>
  </div>
</div>

<script>
history.pushState(null, null, location.href);
window.onpopstate = () => { history.go(1); };

const specialtySelect = document.getElementById("specialty");
const idInput = document.getElementById("idNumber");
const phoneInput = document.getElementById("phone");
const form = document.getElementById("infoForm");
const popup = document.getElementById("popup");
const popupCode = document.getElementById("popupCode");
const copyIcon = document.getElementById("copyIcon");

const SHEET_URL = "https://script.google.com/macros/s/AKfycbwPEsKcfNCqokFU_jpCR4oKdLdbwhcBAPknLiwMqUOreafENmvJSmnbWAfyn06eLAhN/exec"; // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø¨Ø§ URL Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø®ÙˆØ¯Øª

function normalizePhone(input) {
  let value = input.replace(/\s|-/g, '');
  const persian = 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹';
  const arabic  = 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©';
  value = value.replace(/[Û°-Û¹]/g, d => '0123456789'[persian.indexOf(d)]);
  value = value.replace(/[Ù -Ù©]/g, d => '0123456789'[arabic.indexOf(d)]);
  return value;
}

function isValidIranMobile(num) { 
  return /^09\d{9}$/.test(num); 
}

form.addEventListener("submit", (e) => {
  e.preventDefault();

  const fullName = document.getElementById("fullName").value.trim();
  let idNumber = idInput.value.trim();
  let specialty = specialtySelect.value;

  if (!/^\d+$/.test(idNumber)) {
    alert("âŒ Ø´Ù…Ø§Ø±Ù‡ Ù†Ø¸Ø§Ù… ÙÙ‚Ø· Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø´Ø§Ù…Ù„ Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø´Ø¯!");
    idInput.focus(); 
    return;
  }

  let phone = normalizePhone(phoneInput.value.trim());
  if (!isValidIranMobile(phone)) {
    alert("âŒ Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (ÙØ±Ù…Øª ØµØ­ÛŒØ­: 09xxxxxxxxx)");
    phoneInput.focus(); 
    return;
  }

  const finalCode = Math.random().toString(36).substring(2, 8).toUpperCase();

  popupCode.textContent = finalCode;
  popup.style.display = "block";

  // Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ù‡ Ú¯ÙˆÚ¯Ù„ Ø´ÛŒØª Ø¨Ø§ Ø³ØªÙˆÙ† job
  fetch(SHEET_URL, {
    method: "POST",
    body: new URLSearchParams({ 
      fullName, 
      phone, 
      idNumber, 
      job: specialty, // â† ØªØ®ØµØµ Ø¨Ù‡ Ø³ØªÙˆÙ† job Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
      finalCode 
    })
  })
  .then(r => r.json())
  .then(data => console.log("Ù†ØªÛŒØ¬Ù‡:", data))
  .catch(err => console.error("Ø®Ø·Ø§:", err));
});

copyIcon.addEventListener("click", () => {
  navigator.clipboard.writeText(popupCode.textContent)
  .then(() => alert("âœ… Ú©Ø¯ ÛŒÙˆÙ†ÛŒÚ© Ú©Ù¾ÛŒ Ø´Ø¯!"))
  .catch(() => alert("âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ú©Ø¯!"));
});
</script>

</body>
</html>
