<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Vazirmatn', sans-serif; direction: rtl; background: #f0f7ff; text-align: center; padding: 20px; }
  h1 { color: #0d6efd; }
  form { display: inline-block; text-align: right; margin-top: 20px; }
  label { display: block; margin: 10px 0 5px; font-weight: 600; }
  input, select { width: 250px; padding: 8px; border-radius: 6px; border: 1px solid #bbb; margin-bottom: 10px; font-family: 'Vazirmatn', sans-serif; }
  #otherJob { display: none; }
  button { font-size: 18px; padding: 10px 20px; border: none; border-radius: 8px; background: #0d6efd; color: white; font-weight: 600; cursor: pointer; margin-top: 10px; font-family: 'Vazirmatn', sans-serif; }
  .codeBox { margin-top: 20px; font-size: 22px; font-weight: bold; color: #0d6efd; font-family: 'Vazirmatn', sans-serif; }
</style>
</head>
<body>

<h1>ğŸ“ Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</h1>
<form id="infoForm">
  <label>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</label>
  <input type="text" id="fullName" required>
  <label>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</label>
  <input type="text" id="phone" required>
  <label>Ø´Ù…Ø§Ø±Ù‡ Ù†Ø¸Ø§Ù…:</label>
  <input type="text" id="idNumber" required>
  <label>Ø´ØºÙ„:</label>
  <select id="job" required>
    <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
    <option value="doctor">Ù¾Ø²Ø´Ú©</option>
    <option value="nurse">Ù¾Ø±Ø³ØªØ§Ø±</option>
    <option value="other">Ø³Ø§ÛŒØ±</option>
  </select>
  <input type="text" id="otherJob" placeholder="Ù„Ø·ÙØ§ Ø´ØºÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
  <button type="submit">Ø«Ø¨Øª Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯ ÛŒÙˆÙ†ÛŒÚ©</button>
</form>

<div class="codeBox" id="finalCodeBox"></div>

<script>
const jobSelect = document.getElementById("job");
const otherJobInput = document.getElementById("otherJob");
jobSelect.addEventListener("change", () => {
  otherJobInput.style.display = (jobSelect.value === "other") ? "block" : "none";
});

const form = document.getElementById("infoForm");
const codeBox = document.getElementById("finalCodeBox");

// Ù„ÛŒÙ†Ú© Web App Ú¯ÙˆÚ¯Ù„ Ø´ÛŒØª
const SHEET_URL = "https://script.google.com/macros/s/AKfycbwPEsKcfNCqokFU_jpCR4oKdLdbwhcBAPknLiwMqUOreafENmvJSmnbWAfyn06eLAhN/exec";

form.addEventListener("submit", (e) => {
  e.preventDefault();
  
  const fullName = document.getElementById("fullName").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const idNumber = document.getElementById("idNumber").value.trim();
  let job = jobSelect.value;
  if (job === "other") { job = otherJobInput.value.trim() || "other"; }

  // ØªØ¹ÛŒÛŒÙ† Ù¾ÛŒØ´ÙˆÙ†Ø¯ Ø¨Ø±Ø§Ø³Ø§Ø³ Ø´ØºÙ„
  let prefix = "S";
  if (jobSelect.value === "doctor") prefix = "D";
  else if (jobSelect.value === "nurse") prefix = "N";

  const tempCode = localStorage.getItem("tempCode") || Math.random().toString(36).substring(2, 8).toUpperCase();
  const finalCode = prefix + "-" + tempCode;  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù¾ÛŒØ´ÙˆÙ†Ø¯

  codeBox.textContent = "ğŸ‰ Ú©Ø¯ ÛŒÙˆÙ†ÛŒÚ© Ø´Ù…Ø§: " + finalCode;

  // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ú¯ÙˆÚ¯Ù„ Ø´ÛŒØª
  fetch(SHEET_URL, {
    method: "POST",
    body: new URLSearchParams({
      fullName: fullName,
      phone: phone,
      idNumber: idNumber,
      job: job,
      finalCode: finalCode
    })
  })
  .then(response => response.json())
  .then(data => {
    if(data.status === "success"){
      console.log("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯.");
    } else {
      console.error("Ø®Ø·Ø§ Ø¯Ø± Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª:", data.message);
      alert("âš ï¸ Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø«Ø¨Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø® Ø¯Ø§Ø¯. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.");
    }
  })
  .catch(err => {
    console.error("Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡:", err);
    alert("âš ï¸ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ± Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†Ø´Ø¯.");
  });
});
</script>

</body>
</html>
